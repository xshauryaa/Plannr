# üöÄ CRITICAL BACKEND API TESTS FOR iOS LAUNCH
# Testing production API at https://plannr-690n.onrender.com
# All core features for app functionality

### Variables
@baseUrl = https://plannr-690n.onrender.com
@authToken = test-token-123
@clerkUserId = test-user-12345

### ========================================
### ‚úÖ CORE API HEALTH CHECK
### ========================================

### 1. Health Check (Must Work)
GET {{baseUrl}}/api/health
Content-Type: application/json

### ========================================
### üë§ USER AUTHENTICATION & PROFILE APIS
### ========================================

### 2. Login User (Create/Sync User from Clerk)
POST {{baseUrl}}/api/users/auth/login
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "clerkUserId": "test-user-12345",
  "email": "test@plannr.com",
  "displayName": "Test User",
  "avatarUrl": "https://example.com/avatar.jpg"
}

### 3. Get User Profile
GET {{baseUrl}}/api/users/profile
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

### 4. Update User Profile
PUT {{baseUrl}}/api/users/profile
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "displayName": "Updated Test User",
  "avatarUrl": "https://example.com/new-avatar.jpg"
}

### ========================================
### ‚öôÔ∏è USER PREFERENCES APIS
### ========================================

### 5. Get User Preferences
GET {{baseUrl}}/api/preferences
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

### 6. Update User Preferences
PUT {{baseUrl}}/api/preferences
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "theme": "dark",
  "defaultStrategy": "balanced",
  "defaultMinGap": "20",
  "defaultMaxWorkingHours": "9",
  "taskRemindersEnabled": true,
  "leadMinutes": "30",
  "nickname": "TestNick"
}

### 7. Reset Preferences to Default
POST {{baseUrl}}/api/preferences/reset
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

### ========================================
### üìÖ SCHEDULES & BLOCKS APIS  
### ========================================

### 8. Create New Schedule
POST {{baseUrl}}/api/schedules
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "title": "Test Schedule",
  "periodStart": "2024-01-15",
  "periodEnd": "2024-01-21",
  "day1Date": {
    "date": 15,
    "month": 1,
    "year": 2024
  },
  "day1Day": "Monday",
  "isActive": true,
  "numDays": 7,
  "minGap": 15,
  "workingHoursLimit": 8,
  "strategy": "EarliestFit",
  "startTime": 900
}

### 9. Get User Schedules
GET {{baseUrl}}/api/schedules
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

### 10. Get Specific Schedule by ID (Replace with actual schedule ID)
GET {{baseUrl}}/api/schedules/your-schedule-id-here?includeBlocks=true
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

### 11. Update Schedule
PUT {{baseUrl}}/api/schedules/your-schedule-id-here
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "title": "Updated Test Schedule",
  "isActive": false
}

### 12. Add Blocks to Schedule
POST {{baseUrl}}/api/schedules/your-schedule-id-here/blocks
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "blocks": [
    {
      "title": "Morning Workout",
      "activityType": "PERSONAL",
      "priority": "MEDIUM",
      "estimatedDuration": 60,
      "blockDate": "2024-01-15",
      "startTime": 800,
      "endTime": 900,
      "description": "Daily exercise routine"
    }
  ]
}

### 13. Update Specific Block
PUT {{baseUrl}}/api/schedules/your-schedule-id-here/blocks/your-block-id-here
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "title": "Updated Morning Workout",
  "estimatedDuration": 90
}

### 14. Delete Specific Block
DELETE {{baseUrl}}/api/schedules/your-schedule-id-here/blocks/your-block-id-here
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

### 15. Mark Block as Complete/Incomplete
POST {{baseUrl}}/api/schedules/your-schedule-id-here/blocks/your-block-id-here/complete
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "completed": true
}

### 16. Delete Schedule
DELETE {{baseUrl}}/api/schedules/your-schedule-id-here
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

### ========================================
### üß™ AUTOMATED TEST SEQUENCE
### ========================================

### Step 1: Health Check
GET {{baseUrl}}/api/health

### Step 2: Create/Login User
POST {{baseUrl}}/api/users/auth/login
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "clerkUserId": "test-user-12345",
  "email": "test@plannr.com", 
  "displayName": "Test User"
}

### Step 3: Get Preferences (should create defaults if none exist)
GET {{baseUrl}}/api/preferences
x-clerk-user-id: {{clerkUserId}}

### Step 4: Create Schedule
POST {{baseUrl}}/api/schedules
x-clerk-user-id: {{clerkUserId}}
Content-Type: application/json

{
  "title": "Launch Test Schedule",
  "periodStart": "2024-12-27",
  "periodEnd": "2025-01-02", 
  "isActive": true,
  "strategy": "EarliestFit"
}

### Step 5: Verify Schedule Creation
GET {{baseUrl}}/api/schedules
x-clerk-user-id: {{clerkUserId}}

### ========================================
### ‚ùå APIS TO AVOID (DISABLED FOR LAUNCH)
### ========================================

### Microsoft Import APIs (DISABLED)
# GET {{baseUrl}}/api/import/connections
# POST {{baseUrl}}/api/import/auth/microsoft/initiate
# These will return 404 - Route not found (which is expected)

### ========================================
### üéØ SUCCESS CRITERIA FOR iOS SUBMISSION
### ========================================

# ‚úÖ Health check returns {"success": true}
# ‚úÖ User auth/login works and creates user in database  
# ‚úÖ User preferences can be retrieved and updated
# ‚úÖ Schedules can be created, retrieved, and managed
# ‚úÖ Blocks can be added to schedules and manipulated
# ‚úÖ No 500 errors on any core endpoints
# ‚úÖ All authentication works with Clerk user IDs
# ‚úÖ Database operations complete successfully

### ========================================
### üìã MOBILE APP INTEGRATION CHECKLIST
### ========================================

# Frontend APIs to verify:
# - useAuthenticatedAPI hook works with production
# - syncUserToBackend() completes successfully
# - getUserProfile() returns user data
# - getPreferences()/updatePreferences() work
# - getSchedules()/createSchedule() work
# - All CRUD operations on schedules/blocks work
# - Error handling gracefully handles network issues
