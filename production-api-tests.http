# ðŸŽ‰ PRODUCTION API TESTS - Microsoft To-Do Import
# All tests for https://plannr-690n.onrender.com
# Save as production-import-tests.http in VS Code

### Variables
@baseUrl = https://plannr-690n.onrender.com
@authToken = test-token-123
@realAuthToken = your-real-clerk-token-here

### ========================================
### âœ… WORKING TESTS
### ========================================

### 1. Health Check âœ… WORKING
GET {{baseUrl}}/api/health
Content-Type: application/json

### 2. Get Import Connections âœ… WORKING (Empty response expected)
GET {{baseUrl}}/api/import/connections  
Authorization: Bearer {{authToken}}
Content-Type: application/json

### 3. Microsoft OAuth Initiation âœ… WORKING (Should return Microsoft auth URL)
POST {{baseUrl}}/api/import/auth/microsoft/initiate
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "returnUrl": "https://plannr-app.com/import-success"
}

### 4. Start Import Session âœ… WORKING (Expected to fail - no connection yet)
POST {{baseUrl}}/api/import/start
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "provider": "microsoft",
  "options": {
    "includeCompletedTasks": false
  }
}

### ========================================
### ðŸ”„ FULL WORKFLOW TESTS (After OAuth)
### ========================================

### 5. Execute Import (Use real session ID from step 4)
POST {{baseUrl}}/api/import/sessions/your-session-id-here/execute
Authorization: Bearer {{realAuthToken}}
Content-Type: application/json

{
  "options": {
    "includeCompletedTasks": false,
    "selectedLists": []
  }
}

### 6. Get Session Status
GET {{baseUrl}}/api/import/sessions/your-session-id-here/status
Authorization: Bearer {{realAuthToken}}
Content-Type: application/json

### 7. Get Imported Tasks
GET {{baseUrl}}/api/import/sessions/your-session-id-here/tasks?page=1&limit=20
Authorization: Bearer {{realAuthToken}}
Content-Type: application/json

### 8. Generate Schedule from Tasks
POST {{baseUrl}}/api/import/sessions/your-session-id-here/generate-schedule
Authorization: Bearer {{realAuthToken}}
Content-Type: application/json

{
  "scheduleOptions": {
    "startDate": "2024-01-15T00:00:00Z",
    "endDate": "2024-01-31T23:59:59Z",
    "strategy": "balanced",
    "workingHours": {
      "start": 9,
      "end": 17
    },
    "workingDays": [1, 2, 3, 4, 5],
    "bufferTime": 15
  }
}

### 9. Delete Session (Cleanup)
DELETE {{baseUrl}}/api/import/sessions/your-session-id-here
Authorization: Bearer {{realAuthToken}}
Content-Type: application/json

### 10. Disconnect Microsoft Account
DELETE {{baseUrl}}/api/import/auth/microsoft/disconnect
Authorization: Bearer {{realAuthToken}}
Content-Type: application/json

### ========================================
### ðŸ“± MOBILE APP INTEGRATION EXAMPLE
### ========================================

### Step 1: Get Microsoft Auth URL
POST {{baseUrl}}/api/import/auth/microsoft/initiate
Authorization: Bearer {{realAuthToken}}
Content-Type: application/json

{
  "returnUrl": "plannr://import-callback"
}

### Expected Response:
# {
#   "success": true,
#   "authUrl": "https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=a05a33e9-bfe0-4b22-865a-0ce9d269090d&response_type=code&redirect_uri=https%3A%2F%2Fplannr-690n.onrender.com%2Fapi%2Fimport%2Fauth%2Fmicrosoft%2Fcallback&scope=https%3A%2F%2Fgraph.microsoft.com%2FTasks.Read%20https%3A%2F%2Fgraph.microsoft.com%2FCalendars.Read%20offline_access&state=uuid-here&code_challenge=challenge-here&code_challenge_method=S256&prompt=consent",
#   "state": "uuid-here"
# }

### ========================================
### ðŸ§ª cURL COMMANDS FOR TERMINAL TESTING  
### ========================================

### Health Check
# curl -X GET "https://plannr-690n.onrender.com/api/health"

### Get Connections
# curl -X GET "https://plannr-690n.onrender.com/api/import/connections" \
#   -H "Authorization: Bearer test-token-123"

### Start OAuth Flow
# curl -X POST "https://plannr-690n.onrender.com/api/import/auth/microsoft/initiate" \
#   -H "Authorization: Bearer test-token-123" \
#   -H "Content-Type: application/json" \
#   -d '{"returnUrl": "https://plannr-app.com/import-success"}'

### Start Import Session  
# curl -X POST "https://plannr-690n.onrender.com/api/import/start" \
#   -H "Authorization: Bearer test-token-123" \
#   -H "Content-Type: application/json" \
#   -d '{"provider": "microsoft", "options": {"includeCompletedTasks": false}}'
