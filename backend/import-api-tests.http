# Complete Microsoft To-Do Import API Tests
# Save as import-api-tests.http in VS Code
# Install REST Client extension to run these

### Variables for Local Testing
@baseUrl = http://localhost:5001
@authToken = test-token-123

### Variables for Production Testing (update after deployment)
# @baseUrl = https://plannr-690n.onrender.com
# @authToken = your-real-token-here

### 1. âœ… Health Check (Should always work)
GET {{baseUrl}}/api/health
Content-Type: application/json

### 2. Get User Connections (Empty initially)
GET {{baseUrl}}/api/import/connections
Authorization: Bearer {{authToken}}
Content-Type: application/json

### 3. ðŸ”‘ Start Microsoft OAuth Flow (Returns Microsoft auth URL)
POST {{baseUrl}}/api/import/auth/microsoft/initiate
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "returnUrl": "http://localhost:3000/import-success"
}

### 4. Start Import Session (Will fail until user connects Microsoft account)
POST {{baseUrl}}/api/import/start
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "provider": "microsoft",
  "options": {
    "includeCompletedTasks": false,
    "dueDateFilter": {
      "after": "2024-01-01",
      "before": "2025-12-31",
      "requireDueDate": false
    },
    "selectedLists": []
  }
}

### 5. Check Session Status (replace sessionId with real ID from step 4)
GET {{baseUrl}}/api/import/sessions/your-session-id-here/status
Authorization: Bearer {{authToken}}
Content-Type: application/json

### 6. Execute Import (replace sessionId with real ID)
POST {{baseUrl}}/api/import/sessions/your-session-id-here/execute
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "options": {
    "includeCompletedTasks": false,
    "selectedLists": []
  }
}

### 7. Get Imported Tasks (replace sessionId with real ID)
GET {{baseUrl}}/api/import/sessions/your-session-id-here/tasks?page=1&limit=20
Authorization: Bearer {{authToken}}
Content-Type: application/json

### 8. Generate Schedule from Imported Tasks (replace sessionId)
POST {{baseUrl}}/api/import/sessions/your-session-id-here/generate-schedule
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "scheduleOptions": {
    "startDate": "2024-01-15T00:00:00Z",
    "endDate": "2024-01-31T23:59:59Z",
    "strategy": "balanced",
    "workingHours": {
      "start": 9,
      "end": 17
    },
    "workingDays": [1, 2, 3, 4, 5],
    "bufferTime": 15
  }
}

### 9. Delete Import Session (cleanup)
DELETE {{baseUrl}}/api/import/sessions/your-session-id-here
Authorization: Bearer {{authToken}}
Content-Type: application/json

### 10. Disconnect Microsoft Account
DELETE {{baseUrl}}/api/import/auth/microsoft/disconnect
Authorization: Bearer {{authToken}}
Content-Type: application/json

### 11. Admin: Cleanup Expired Sessions
GET {{baseUrl}}/api/import/cleanup
Authorization: Bearer {{authToken}}
Content-Type: application/json

### ========================================
### cURL Commands (for terminal testing)
### ========================================

### Health Check
# curl -X GET "http://localhost:5001/api/health"

### OAuth Initiation  
# curl -X POST "http://localhost:5001/api/import/auth/microsoft/initiate" \
#   -H "Authorization: Bearer test-token-123" \
#   -H "Content-Type: application/json" \
#   -d '{"returnUrl": "http://localhost:3000/success"}'

### Start Import
# curl -X POST "http://localhost:5001/api/import/start" \
#   -H "Authorization: Bearer test-token-123" \
#   -H "Content-Type: application/json" \
#   -d '{"provider": "microsoft", "options": {"includeCompletedTasks": false}}'
